{"version":3,"file":"initmathjax.min.js","sources":["../src/initmathjax.js"],"sourcesContent":["define([\"jquery\", \"core/ajax\", \"core_filters/events\", 'filter_mathjaxloader/loader'], function ($, Ajax, FilterEvents, MathJaxLoader) {\n\n    // Selectors and other strings defined here.\n    const SELECTORS = {\n        root: '.monassis',\n        mathEquation: '.latex-math',\n        questionContent: '.question-content',\n        classes: {\n            filterMathjax: 'filter_mathjaxloader_equation'\n        }\n    };\n\n    // Parent element of the questions.\n    const root = document.querySelector(SELECTORS.root);\n\n    const mathJaxFilterByEvents = function (isSupported = true) {\n\n        /**\n         * Update the equations by mathjax filter.\n         */\n        function updateMathJax() {\n\n            if (root.querySelector(SELECTORS.questionContent) === null) {\n                return false;\n            }\n\n            if (root.querySelector(SELECTORS.questionContent).innerHTML === '') {\n                return false;\n            }\n\n            // Initialise MathJax typesetting.\n            root.querySelector(SELECTORS.questionContent).classList.add(SELECTORS.classes.filterMathjax);\n\n            // Notifiy the siyavula filtered content are updated.\n            if (isSupported) {\n                FilterEvents.notifyFilterContentUpdated(document.querySelectorAll(SELECTORS.root));\n            } else {\n                window.MathJax.Hub?.Queue([\"Typeset\", window.MathJax.Hub, root.querySelector(SELECTORS.questionContent)]);\n            }\n\n            return true;\n\n        }\n\n        // Update the equations, if the content loaded before JS initiated.\n        var count = 0;\n        var waitForMathJax = setInterval(function () {\n\n            try {\n                if (window.MathJax && updateMathJax()) {\n                    clearInterval(waitForMathJax);\n                    window.MathJax.Hub?.Queue([\"Typeset\", window.MathJax.Hub]);\n                }\n\n            } catch (e) {\n                // MathJax has not yet been loaded.\n            }\n            count++;\n            if (count > 200) {\n                clearInterval(waitForMathJax);\n                console.warn('MathJax did not load in time, please check your MathJax configuration.');\n            }\n\n        }, 100);\n\n    };\n\n    return {\n\n        init: function (isSupported = true) {\n\n            // Moodle 5.0 and later versions support the MathJax filter.\n            if (!isSupported && window.MathJax.version === undefined) {\n                // Make the mathjax filter work with the Siyavula filter.\n                // It helps to make the mathjax.hub is initialized.\n                MathJaxLoader.loadMathJax();\n            }\n\n            mathJaxFilterByEvents(isSupported);\n        },\n    };\n\n});\n"],"names":["define","$","Ajax","FilterEvents","MathJaxLoader","SELECTORS","filterMathjax","root","document","querySelector","mathJaxFilterByEvents","isSupported","updateMathJax","innerHTML","classList","add","notifyFilterContentUpdated","querySelectorAll","window","MathJax","Hub","Queue","count","waitForMathJax","setInterval","clearInterval","e","console","warn","init","undefined","version","loadMathJax"],"mappings":"AAAAA,qCAAO,CAAC,SAAU,YAAa,sBAAuB,gCAAgC,SAAUC,EAAGC,KAAMC,aAAcC,qBAG7GC,eACI,YADJA,0BAGe,oBAHfA,kBAIO,CACLC,cAAe,iCAKjBC,KAAOC,SAASC,cAAcJ,gBAE9BK,sBAAwB,eAAUC,gFAK3BC,mBAEiD,OAAlDL,KAAKE,cAAcJ,kCACZ,KAGqD,KAA5DE,KAAKE,cAAcJ,2BAA2BQ,iBACvC,2BAIXN,KAAKE,cAAcJ,2BAA2BS,UAAUC,IAAIV,kBAAkBC,eAG1EK,aACAR,aAAaa,2BAA2BR,SAASS,iBAAiBZ,6CAElEa,OAAOC,QAAQC,wDAAKC,MAAM,CAAC,UAAWH,OAAOC,QAAQC,IAAKb,KAAKE,cAAcJ,oCAG1E,MAKPiB,MAAQ,EACRC,eAAiBC,aAAY,2CAGrBN,OAAOC,SAAWP,gBAClBa,cAAcF,6CACdL,OAAOC,QAAQC,0DAAKC,MAAM,CAAC,UAAWH,OAAOC,QAAQC,MAG3D,MAAOM,MAGTJ,MACY,MACRG,cAAcF,gBACdI,QAAQC,KAAK,6EAGlB,YAIA,CAEHC,KAAM,eAAUlB,uEAGPA,kBAA0CmB,IAA3BZ,OAAOC,QAAQY,SAG/B3B,cAAc4B,cAGlBtB,sBAAsBC"}